---
title: "Data 607 Assignment"
author: "Ken Popkin"
date: "2/26/2020"
output: html_document
---
## Assignment Summary
The data for this assignment is loaded in a wide format, making it difficult to immediately perform exploratory work on the dataset.  To address this the data will be reformatted from a wide to long format.

Exploratory work to address the following questions will be completed with the reformatted data. </br>
Information about each airline: </br>
1. What is the number of ontime and delayed flights for each airline? </br>
2. What is the percentage of flight delays for each airline? </br>

Information about each destination (regardless of airline) </br>
3. Do delays tend to focus on only one or two destinations or are they evenly distributed across all destinations? </br>
4. Which destination has the most flights (highest volume)? </br>

A conclusion section will discuss these questions... </br>
5. What conclusions or theories can be drawn from the results that could help alleviate future delays? </br>
6. What additional data might be helpful to futher analyze this dataset and potentially alleviate future delays? </br>

## Setup and load data
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r}
library(dplyr)
library(tidyr)
library(data.table)
library(ggplot2)
```

```{r, Load-text-file}
data <-  read.csv('flights.csv')
head(data,4)
```

## Tidy up the data
```{r}
#lower case the columns and replace "." with "_"
names(data) <- tolower(names(data))
names(data) <- gsub(x = names(data), pattern = "\\.", replacement = "_")  
names(data) <- gsub(x = names(data), pattern = "\\__", replacement = "_")  
names(data) <- gsub(x = names(data), pattern = "\\Ã¯_", replacement = "")  
data
```

```{r}
#Stack the destination data
data2 <- pivot_longer(data,c(los_angeles, phoenix, san_diego, san_francisco, seattle), 'destination')
data2
```

## Explore the Questions
<B> 1. What is the number of ontime and delayed flights for each airline? </B>
```{r}

total_ontime_delays <- select(data2, airline, status, value)
total_ontime_delays <- group_by(total_ontime_delays,airline, status) %>% summarise(total = sum(value))
total_ontime_delays
```

 <B> 2. What is the percentage of flight delays for each airline?  </B>
```{r}
delays_percent <- pivot_wider(total_ontime_delays, names_from = status, values_from = total)
names(delays_percent) <- gsub(x = names(delays_percent), pattern = "\\ ", replacement = "_")  

delays_percent$percent_flights_delayed <- round(delays_percent$delayed/delays_percent$on_time,2)

delays_percent
```

 <B> 3. Do delays tend to focus on only one or two destinations or are they evenly distributed across all destinations? </B>
```{r}
#Move from narrow back to wide format
per_dest <- select(data2, status, destination, value)

per_dest <- group_by(per_dest, status, destination) %>% 
                                summarise(total = sum(value))

per_dest <- pivot_wider(per_dest, names_from = c(status, destination), values_from = total)
names(per_dest) <- gsub(x = names(per_dest), pattern = "\\ ", replacement = "_")  

per_dest$total <- rowSums(Filter(is.numeric,per_dest))

per_dest
```

```{r}
#Calculate percentages
#Los Angeles
per_dest$losangeles_delayed_percent <- round(per_dest$delayed_los_angeles/(per_dest$delayed_los_angeles +        per_dest$on_time_los_angeles),2)
   
per_dest$losangeles_ontime_percent <- round(per_dest$on_time_los_angeles/(per_dest$delayed_los_angeles +        per_dest$on_time_los_angeles),2)

#Phoenix
per_dest$phoenix_delayed_percent <- round(per_dest$delayed_phoenix/(per_dest$delayed_phoenix +        per_dest$on_time_phoenix),2)
   
per_dest$phoenix_ontime_percent <- round(per_dest$on_time_phoenix/(per_dest$delayed_phoenix +        per_dest$on_time_phoenix),2)

#San Diego
per_dest$sandiego_delayed_percent <- round(per_dest$delayed_san_diego/(per_dest$delayed_san_diego +        per_dest$on_time_san_diego),2)
   
per_dest$sandiego_ontime_percent <- round(per_dest$on_time_san_diego/(per_dest$delayed_san_diego +        per_dest$on_time_san_diego),2)

#San Francisco
per_dest$sanfrancisco_delayed_percent <- round(per_dest$delayed_san_francisco/(per_dest$delayed_san_francisco +        per_dest$on_time_san_francisco),2)
   
per_dest$sanfrancisco_ontime_percent <- round(per_dest$on_time_san_francisco/(per_dest$delayed_san_francisco +        per_dest$on_time_san_francisco),2)

#Seattle
per_dest$seattle_delayed_percent <- round(per_dest$delayed_seattle/(per_dest$delayed_seattle +        per_dest$on_time_seattle),2)
   
per_dest$seattle_ontime_percent <- round(per_dest$on_time_seattle/(per_dest$delayed_seattle +        per_dest$on_time_seattle),2)

perdest2 <- select(per_dest, losangeles_ontime_percent, losangeles_delayed_percent, phoenix_ontime_percent, phoenix_delayed_percent, sanfrancisco_ontime_percent, sanfrancisco_delayed_percent, sandiego_ontime_percent,sandiego_delayed_percent, seattle_ontime_percent, seattle_delayed_percent)

perdest2
```
```{r}
specie <- c(rep("sorgho" , 3) , rep("poacee" , 3) , rep("banana" , 3) , rep("triticum" , 3) )
condition <- rep(c("normal" , "stress" , "Nitrogen") , 4)
value <- abs(rnorm(12 , 0 , 15))
data <- data.frame(specie,condition,value)
data
```



 <B> 4. Which destination has the most flights (highest volume)? </B>
